<Window x:Class="YoloAnnotator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:YoloAnnotator"
        xmlns:converters="clr-namespace:YoloAnnotator.Converters"
        mc:Ignorable="d"
        Title="YOLO Studio" MinHeight="700" MinWidth="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        FontFamily="Segoe UI"
        WindowStyle="None"
        SizeChanged="Window_SizeChanged">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <converters:AnnotatedStatusConverter x:Key="AnnotatedStatusConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <!-- 自定义标题栏 -->
            <RowDefinition Height="36"/>
            <!-- 顶部菜单栏 -->
            <RowDefinition Height="*"/>
            <!-- 主工作区 -->
            <RowDefinition Height="22"/>
            <!-- 底部状态栏 -->
        </Grid.RowDefinitions>

        <!-- 自定义标题栏 -->
        <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 标题 -->
                <TextBlock Grid.Column="0" Text="YOLO Studio" FontWeight="SemiBold" FontSize="12"
                          VerticalAlignment="Center" Margin="12,0" Foreground="{StaticResource TextPrimaryBrush}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsActive, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                                    <Setter Property="Foreground" Value="#666666"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <!-- 窗口控制按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Name="BtnMinimize" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMinimize_Click">
                        <Path Data="M0,8 L16,8" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnMaximize" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMaximize_Click">
                        <Path Data="M0,0 L12,0 L12,12 L0,12 Z" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnRestore" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMaximize_Click" Visibility="Collapsed">
                        <Path Data="M0,2 L12,2 L12,14 L0,14 Z M2,2 L2,0 L14,0 L14,12 L12,12" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnClose" Style="{StaticResource TitleBarCloseButtonStyle}" Click="BtnClose_Click">
                        <Path Data="M0,0 L12,12 M12,0 L0,12" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 顶部菜单栏 -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Margin="8,4">
                <!-- 菜单按钮 -->
                <Button Name="BtnOpenDir" Content="打开目录 (Ctrl+U)" Click="BtnUpload_Click" Style="{StaticResource MenuButtonStyle}"/>
                <Button Name="BtnSave" Content="保存 (Ctrl+S)" Click="BtnSave_Click" Style="{StaticResource MenuButtonStyle}"/>
                <Button Name="BtnAutoAnnotation" Content="自动标注" Click="BtnAutoAnnotation_Click" Style="{StaticResource MenuButtonStyle}" 
                        ToolTip="使用预训练模型快速标注"/>
                <Button Name="BtnExport" Content="导出数据集" Click="BtnExport_Click" Style="{StaticResource MenuButtonStyle}"/>
                <Button Name="BtnVideoDetection" Content="视频检测" Click="BtnVideoDetection_Click" Style="{StaticResource MenuButtonStyle}"/>
                <Separator Margin="8,0" Width="1" Background="{StaticResource BorderBrush}"/>
                <Button Name="BtnClearAll" Content="清理所有图" Click="BtnClearAll_Click" Style="{StaticResource MenuButtonStyle}"/>
                <Button Name="BtnDeleteTrainingData" Content="删除训练数据" Click="BtnDeleteTrainingData_Click" Style="{StaticResource MenuButtonStyle}"/>
            </StackPanel>
        </Border>

        <!-- 主工作区 -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="90" MinWidth="85"/>
                <!-- 工具栏 -->
                <ColumnDefinition Width="220" MinWidth="180"/>
                <!-- 文件列表 -->
                <ColumnDefinition Width="*" MinWidth="400"/>
                <!-- 画布 -->
                <ColumnDefinition Width="270" MinWidth="240"/>
                <!-- 标签面板 -->
            </Grid.ColumnDefinitions>

            <!-- 左侧工具栏 -->
            <Border Grid.Column="0" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="4,6">
                    <TextBlock Text="标注工具" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4" FontWeight="SemiBold"/>

                    <!-- 矩形框 -->
                    <ToggleButton Name="BtnRectTool" IsChecked="True" Click="BtnRectTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Border Width="16" Height="16" BorderBrush="#22c55e" BorderThickness="2" CornerRadius="1" HorizontalAlignment="Center"/>
                            <TextBlock Text="矩形 (R)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 多边形 -->
                    <ToggleButton Name="BtnPolygonTool" Click="BtnPolygonTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Polygon Points="3,15 9,3 15,15" Stroke="#ef4444" StrokeThickness="2" Fill="Transparent"
                                     StrokeLineJoin="Round" Width="16" Height="16" Stretch="Uniform" HorizontalAlignment="Center"/>
                            <TextBlock Text="多边形 (P)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 关键点 -->
                    <ToggleButton Name="BtnKeypointsTool" Click="BtnKeypointsTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Grid Width="16" Height="16" HorizontalAlignment="Center">
                                <Ellipse Width="2.5" Height="2.5" Fill="#f59e0b" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <Ellipse Width="2.5" Height="2.5" Fill="#f59e0b" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0.5,0.5,0,0"/>
                                <Ellipse Width="2.5" Height="2.5" Fill="#f59e0b" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,0.5,0.5,0"/>
                                <Ellipse Width="2.5" Height="2.5" Fill="#f59e0b" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="0.5,0,0,0.5"/>
                                <Ellipse Width="2.5" Height="2.5" Fill="#f59e0b" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,0.5,0.5"/>
                            </Grid>
                            <TextBlock Text="关键点 (K)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0" Width="44" Height="10"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 旋转框 -->
                    <ToggleButton Name="BtnRotateRectTool" Click="BtnRotateRectTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Border Width="13" Height="13" BorderBrush="#f97316" BorderThickness="2" CornerRadius="1"
                                    RenderTransformOrigin="0.402,-0.51">
                                <Border.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform/>
                                        <SkewTransform/>
                                        <RotateTransform Angle="14.999999999999998"/>
                                        <TranslateTransform X="3.971" Y="0.136"/>
                                    </TransformGroup>
                                </Border.RenderTransform>
                            </Border>
                            <TextBlock Text="旋转框 (O)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 圆形 -->
                    <ToggleButton Name="BtnCircleTool" Click="BtnCircleTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Ellipse Width="16" Height="16" Stroke="#06b6d4" StrokeThickness="2" Fill="Transparent" HorizontalAlignment="Center"/>
                            <TextBlock Text="圆形 (C)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 线段 -->
                    <ToggleButton Name="BtnLineTool" Click="BtnLineTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Line X1="2" Y1="14" X2="14" Y2="2" Stroke="#a855f7" StrokeThickness="2" 
                                  Width="16" Height="16" Stretch="Uniform" HorizontalAlignment="Center"/>
                            <TextBlock Text="线段 (L)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 点标注 -->
                    <ToggleButton Name="BtnPointTool" Click="BtnPointTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Ellipse Width="8" Height="8" Fill="#eab308" HorizontalAlignment="Center"/>
                            <TextBlock Text="点 (T)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 拖动/手掌 -->
                    <ToggleButton Name="BtnPanTool" Click="BtnPanTool_Click"
                                  Style="{StaticResource SimpleToggleButtonStyle}"
                                  Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Path Data="M8,2 L8,12 M2,7 L12,7" Stroke="#8b5cf6" StrokeThickness="2"
                                  Width="16" Height="16" Stretch="Uniform" HorizontalAlignment="Center"/>
                            <TextBlock Text="拖动 (H)" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </ToggleButton>

                    <Separator Margin="4,6"/>

                    <TextBlock Text="模型" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4" FontWeight="SemiBold"/>

                    <!-- 训练 -->
                    <Button Name="BtnTrain" Click="BtnTrain_Click"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Polygon Points="4,13 8,7 13,7 13,13" Fill="{StaticResource TextPrimaryBrush}" Width="16" Height="16" Stretch="Uniform" HorizontalAlignment="Center"/>
                            <TextBlock Text="训练" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Button>

                    <!-- 检测 -->
                    <Button Name="BtnDetect" Click="BtnDetect_Click"
                            Style="{StaticResource SecondaryButtonStyle}"
                            Width="75" Height="42" Margin="0,1">
                        <StackPanel>
                            <Grid Width="16" Height="16" HorizontalAlignment="Center">
                                <Border Width="14" Height="10" BorderBrush="{StaticResource TextPrimaryBrush}" BorderThickness="2" CornerRadius="1"/>
                                <Border Width="5" Height="3.5" BorderBrush="{StaticResource TextPrimaryBrush}" BorderThickness="2" CornerRadius="1"
                                        HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,1"/>
                            </Grid>
                            <TextBlock Text="检测" FontSize="9" Foreground="#90ffffff" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Button>

                    <!-- 网格 -->
                </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- 文件列表 -->
            <Border Grid.Column="1" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Margin="10,8,10,6">
                        <Grid>
                            <TextBlock Text="文件列表" FontWeight="SemiBold" FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <TextBlock Name="TxtImageCount" Text="0 个文件" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </Grid>
                        <TextBlock Name="TxtAnnotatedCount" Text="已标注: 0 | 待标注: 0"
                                  FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                    </StackPanel>

                    <ListBox Name="LstImages" Grid.Row="1" Background="Transparent" BorderThickness="0"
                             SelectionChanged="LstImages_SelectionChanged" Padding="4">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="Transparent" CornerRadius="3" Padding="6,5" Margin="0,0,0,2">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Width="6" Height="6" VerticalAlignment="Center"
                                                Fill="{Binding IsAnnotated, Converter={StaticResource AnnotatedStatusConverter}}"/>
                                        <TextBlock Grid.Column="1" Text="{Binding Name}" Foreground="{StaticResource TextPrimaryBrush}"
                                                  VerticalAlignment="Center" FontSize="12" TextWrapping="Wrap"
                                                  TextTrimming="CharacterEllipsis" Margin="10,0,0,0"
                                                  MaxHeight="40"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <!-- 导航按钮 -->
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Margin="6,4"/>
                </DockPanel>
            </Border>

            <!-- 画布区域 -->
            <Border Grid.Column="2" Background="#0a0a0a">
                <Grid>
                    <!-- Canvas -->
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Grid Name="CanvasContainer" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Canvas Name="AnnotationCanvas" Background="#000000"
                                    MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                                    MouseMove="Canvas_MouseMove"
                                    MouseLeftButtonUp="Canvas_MouseLeftButtonUp"
                                    MouseRightButtonDown="Canvas_MouseRightButtonDown"
                                    MouseWheel="Canvas_MouseWheel"
                                    MouseLeave="Canvas_MouseLeave">
                                <Image Name="CurrentImage" Stretch="Uniform"/>
                                <Canvas Name="BboxCanvas"/>
                                <!-- 十字光标 -->
                                <Line Name="CrossHairH" Stroke="#00ff00" StrokeThickness="1" X1="0" Y1="0" X2="0" Y2="0" Visibility="Collapsed"/>
                                <Line Name="CrossHairV" Stroke="#00ff00" StrokeThickness="1" X1="0" Y1="0" X2="0" Y2="0" Visibility="Collapsed"/>
                            </Canvas>
                        </Grid>
                    </ScrollViewer>

                    <!-- 缩放控制 -->
                    <Border HorizontalAlignment="Left" VerticalAlignment="Bottom"
                            Margin="12" Background="#80000000" Padding="6,4" CornerRadius="3">
                        <StackPanel Orientation="Horizontal">
                            <Button Name="BtnZoomOut" Content="-" Width="28" Height="26"
                                    Style="{StaticResource ZoomButtonStyle}" Click="BtnZoomOut_Click"/>
                            <TextBlock Name="TxtZoomLevel" Text="100%" Width="40" TextAlignment="Center"
                                      VerticalAlignment="Center" Foreground="#e0e0e0" FontSize="12"/>
                            <Button Name="BtnZoomIn" Content="+" Width="28" Height="26"
                                    Style="{StaticResource ZoomButtonStyle}" Click="BtnZoomIn_Click"/>
                            <Button Name="BtnZoomReset" Content="重置" Width="53" Height="28"
                                    Style="{StaticResource SecondaryButtonStyle}" Margin="4,0,0,0" Click="BtnZoomReset_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- 当前工具提示 -->
                    <Border HorizontalAlignment="Right" VerticalAlignment="Top" 
                            Margin="12" Background="#80000000" Padding="8,4" CornerRadius="3">
                        <TextBlock Name="TxtCurrentTool" Text="工具: 矩形框"
                                                          Foreground="#e0e0e0" FontSize="12"/>
                    </Border>

                    <!-- 坐标显示 -->
                    <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                                                    Margin="12" Background="#80000000" Padding="8,4" CornerRadius="3">
                        <TextBlock Name="TxtMousePosition" Text="X: 0 Y: 0"
                                                          Foreground="#00ff00" FontSize="12" FontWeight="SemiBold"/>
                    </Border>
                </Grid>
            </Border>

            <!-- 右侧标签面板 -->
            <Border Grid.Column="3" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <!-- 标签管理面板 -->
                        <Expander Header="标签管理" IsExpanded="True" Background="Transparent" BorderThickness="0"
                                 Foreground="{StaticResource TextPrimaryBrush}" Padding="8,4">
                            <StackPanel>
                                <WrapPanel Margin="0,4,0,6">
                                    <Button Content="YOLO" Style="{StaticResource FormatButtonStyle}" IsEnabled="False"/>
                                    <Button Content="OBB" Style="{StaticResource FormatButtonStyle}" Click="BtnExportOBB_Click"/>
                                    <Button Content="Seg" Style="{StaticResource FormatButtonStyle}" Click="BtnExportSeg_Click"/>
                                    <Button Content="Pose" Style="{StaticResource FormatButtonStyle}" Click="BtnExportPose_Click"/>
                                </WrapPanel>

                                <ListBox Name="LstLabels" Background="Transparent" BorderThickness="0" Padding="0" MaxHeight="140">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="Transparent" CornerRadius="3" Padding="6,5" Margin="0,0,0,2">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Border Grid.Column="0" Width="10" Height="10" Background="{Binding Color}" CornerRadius="1"
                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding Name}" Margin="8,0,0,0"
                                                              Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" FontSize="11"
                                                              TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding Count}" Foreground="{StaticResource TextSecondaryBrush}"
                                                              Margin="8,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <Button Name="BtnManageClasses" Content="类别管理" Click="BtnManageClasses_Click"
                                        Style="{StaticResource PrimaryButtonStyle}" Margin="0,6,0,0" Height="30" Background="#FF2A846E"/>
                            </StackPanel>
                        </Expander>

                        <Separator Margin="8,4"/>

                        <!-- 当前标注面板 -->
                        <Expander Header="当前标注" IsExpanded="True" Background="Transparent" BorderThickness="0"
                                 Foreground="{StaticResource TextPrimaryBrush}" Padding="8,4">
                            <StackPanel>
                                <TextBlock Name="TxtCurrentBboxes" Text="0 个标注框"
                                          FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>

                                <!-- 批量编辑区域 -->
                                <Border Name="BatchEditPanel" Background="#2a2a2a" CornerRadius="3" Padding="8,6" Margin="0,0,0,6"
                                        Visibility="Collapsed">
                                    <StackPanel>
                                        <TextBlock Text="批量编辑" FontSize="10" Foreground="#FF8888" Margin="0,0,0,4"/>
                                        <ComboBox Name="CboBatchClass" Height="24" Margin="0,0,0,6"
                                                  Foreground="{StaticResource TextPrimaryBrush}" Background="#333333"
                                                  BorderBrush="#444444" Padding="4,2"/>
                                        <Button Name="BtnApplyBatchEdit" Content="应用到选中项" Click="BtnApplyBatchEdit_Click"
                                                Style="{StaticResource SecondaryButtonStyle}" Height="26" FontSize="10"/>
                                    </StackPanel>
                                </Border>

                                <ListBox Name="LstBboxes" Background="Transparent" BorderThickness="0"
                                         Padding="0" MaxHeight="180" Margin="0,0,0,4">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="Transparent" CornerRadius="3" Padding="6,5" Margin="0,0,0,2">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Border Grid.Column="0" Width="8" Height="8" Background="{Binding ClassColor}" CornerRadius="1"
                                                            VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding Bbox.ClassName}" Margin="6,0,0,0"
                                                              Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" FontSize="11"
                                                              TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding Bbox.Confidence, StringFormat='{}({0:F2})'}"
                                                              Foreground="{StaticResource TextSecondaryBrush}" Margin="8,0,0,0" VerticalAlignment="Center" FontSize="10"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <!-- 操作按钮 -->
                                <StackPanel>
                                    <Button Name="BtnDeleteBbox" Content="删除选中" Click="BtnDeleteBbox_Click"
                                            Style="{StaticResource SecondaryButtonStyle}" Height="30" Margin="0,2"/>
                                    <Button Name="BtnClearBboxes" Content="清空标注" Click="BtnClearBboxes_Click"
                                            Style="{StaticResource SecondaryButtonStyle}" Height="30" Margin="0,2" Width="253"/>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <Separator Margin="8,4"/>

                        <!-- 快速属性面板 -->

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- 底部状态栏 -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0" Padding="0,2">
            <Grid>
                <StackPanel Orientation="Horizontal" Margin="12,0">
                    <TextBlock Name="StatusBarText" Text="就绪" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" VerticalAlignment="Center"/>
                    <Separator Margin="12,4" Width="1" Background="{StaticResource BorderBrush}"/>
                    <TextBlock Name="StatusBarTool" Text="工具: 矩形框" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" VerticalAlignment="Center"/>
                    <Separator Margin="12,4" Width="1" Background="{StaticResource BorderBrush}"/>
                    <TextBlock Name="StatusBarGPU" Text="GPU: 未检测" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Name="StatusBarImage" Text="" Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="12,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>