<Window x:Class="YoloAnnotator.ClassSelectDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="选择类别" Height="450" Width="500"
        WindowStartupLocation="CenterOwner"
        Background="{StaticResource BackgroundBrush}"
        WindowStyle="None"
        ResizeMode="NoResize">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}" />
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <!-- 自定义标题栏 -->
            <RowDefinition Height="*"/>
            <!-- 主内容区 -->
            <RowDefinition Height="Auto"/>
            <!-- 底部按钮区 -->
        </Grid.RowDefinitions>

        <!-- 自定义标题栏 -->
        <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 标题 -->
                <TextBlock Grid.Column="0" Text="选择类别" FontWeight="SemiBold" FontSize="12"
                          VerticalAlignment="Center" Margin="12,0" Foreground="{StaticResource TextPrimaryBrush}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsActive, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                                    <Setter Property="Foreground" Value="#666666"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <!-- 窗口控制按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Name="BtnClose" Style="{StaticResource TitleBarCloseButtonStyle}" Click="BtnClose_Click">
                        <Path Data="M0,0 L12,12 M12,0 L0,12" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 主内容区 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid Margin="24">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 标题 -->
                <StackPanel Grid.Row="0" Margin="0,0,0,16">
                    <TextBlock Text="选择标注类别" FontSize="16" FontWeight="SemiBold" 
                              Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Text="双击列表项或按回车键快速选择" FontSize="11" 
                              Foreground="{StaticResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>

                <!-- 输入区域 -->
                <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                        CornerRadius="4" Padding="12" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="新类别:" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"
                                      VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Name="TxtClassName" Width="200" Height="32"
                                     FontSize="12" VerticalAlignment="Center" KeyDown="TxtClassName_KeyDown"/>
                        </StackPanel>

                        <Button Grid.Column="1" Content="添加" Width="80" Height="32" Margin="8,0,0,0"
                                Style="{StaticResource PrimaryButtonStyle}" Click="BtnAddClass_Click"/>
                    </Grid>
                </Border>

                <!-- 类别统计 -->
                <TextBlock Grid.Row="2" Name="TxtClassCount" Text="共 0 个类别" FontSize="11" 
                          Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,8"/>

                <!-- 类别列表 -->
                <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" 
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" 
                        CornerRadius="4" MinHeight="200">
                    <ListBox Name="LstClasses" 
                             SelectionMode="Single" 
                             MouseDoubleClick="LstClasses_MouseDoubleClick"
                             BorderThickness="0"
                             Background="Transparent"
                             Padding="4">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="Transparent" CornerRadius="3" Padding="10,8" Margin="0,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- 颜色标识 -->
                                        <Border Grid.Column="0" Width="16" Height="16" 
                                                Background="{Binding Color}" CornerRadius="3"
                                                VerticalAlignment="Center" Margin="0,0,12,0"/>
                                        
                                        <!-- 类别名称 -->
                                        <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                                  Foreground="{StaticResource TextPrimaryBrush}" 
                                                  FontSize="12" VerticalAlignment="Center"/>
                                        
                                        <!-- 类别ID -->
                                        <TextBlock Grid.Column="2" Text="{Binding Id}" 
                                                  Foreground="{StaticResource TextSecondaryBrush}" 
                                                  FontSize="10" VerticalAlignment="Center" Opacity="0.6"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
        </ScrollViewer>

        <!-- 底部按钮区 -->
        <Border Grid.Row="2" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
            <StackPanel Margin="16,12" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Name="BtnCancel" Content="取消" Click="BtnCancel_Click"
                        Style="{StaticResource SecondaryButtonStyle}" Width="80" Height="32" Margin="0,0,8,0"/>
                <Button Name="BtnOK" Content="确定" Click="BtnOK_Click"
                        Style="{StaticResource PrimaryButtonStyle}" Width="80" Height="32"/>
            </StackPanel>
        </Border>

    </Grid>
</Window>