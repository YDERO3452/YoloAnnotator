<Window x:Class="YoloAnnotator.VideoDetectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="视频检测" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        FontFamily="Segoe UI"
        WindowStyle="None"
        SizeChanged="Window_SizeChanged">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="32" ResizeBorderThickness="{x:Static SystemParameters.WindowResizeBorderThickness}" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <!-- 标题栏按钮样式 -->
        <Style x:Key="TitleBarButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" Padding="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource TitleBarButtonHover}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 关闭按钮样式 -->
        <Style x:Key="TitleBarCloseButtonStyle" TargetType="Button" BasedOn="{StaticResource TitleBarButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource TitleBarCloseHover}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <!-- 自定义标题栏 -->
            <RowDefinition Height="Auto"/>
            <!-- 顶部控制栏 -->
            <RowDefinition Height="*"/>
            <!-- 视频显示区 -->
            <RowDefinition Height="Auto"/>
            <!-- 底部信息栏 -->
        </Grid.RowDefinitions>

        <!-- 自定义标题栏 -->
        <Border Grid.Row="0" Background="{StaticResource TitleBarBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 标题 -->
                <TextBlock Grid.Column="0" Text="视频检测" FontWeight="SemiBold" FontSize="12"
                          VerticalAlignment="Center" Margin="12,0" Foreground="{StaticResource TextPrimaryBrush}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsActive, RelativeSource={RelativeSource AncestorType=Window}}" Value="False">
                                    <Setter Property="Foreground" Value="#666666"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <!-- 窗口控制按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Name="BtnMinimize" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMinimize_Click">
                        <Path Data="M0,8 L16,8" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnMaximize" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMaximize_Click">
                        <Path Data="M0,0 L12,0 L12,12 L0,12 Z" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnRestore" Style="{StaticResource TitleBarButtonStyle}" Click="BtnMaximize_Click" Visibility="Collapsed">
                        <Path Data="M0,2 L12,2 L12,14 L0,14 Z M2,2 L2,0 L14,0 L14,12 L12,12" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <Button Name="BtnClose" Style="{StaticResource TitleBarCloseButtonStyle}" Click="BtnClose_Click">
                        <Path Data="M0,0 L12,12 M12,0 L0,12" Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"
                              Stretch="Uniform" Width="10" Height="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 顶部控制栏 -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1" Padding="12,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 视频源选择 -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="视频源:" VerticalAlignment="Center" Margin="0,0,8,0" 
                              Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                    
                    <!-- 源类型选择 -->
                    <ComboBox Name="CboSourceType" Width="100" Height="30" FontSize="11" 
                              SelectionChanged="CboSourceType_SelectionChanged" Margin="0,0,6,0">
                        <ComboBoxItem Content="视频文件" Tag="file" IsSelected="True"/>
                        <ComboBoxItem Content="本地摄像头" Tag="camera"/>
                        <ComboBoxItem Content="RTSP流" Tag="rtsp"/>
                    </ComboBox>
                    
                    <!-- 文件选择 -->
                    <StackPanel Name="PanelFileSource" Orientation="Horizontal" Margin="0,0,8,0">
                        <ComboBox Name="CboVideoSource" Width="280" Height="30" FontSize="11" 
                                  IsEditable="False" Margin="0,0,6,0"/>
                        <Button Name="BtnSelectVideo" Content="浏览" Style="{StaticResource SecondaryButtonStyle}"
                                Width="60" Height="30" Click="BtnSelectVideo_Click"/>
                    </StackPanel>
                    
                    <!-- RTSP输入 -->
                    <StackPanel Name="PanelRtspSource" Orientation="Horizontal" Visibility="Collapsed" Margin="0,0,8,0">
                        <TextBox Name="TxtRtspUrl" Width="340" Height="30" FontSize="11" 
                                 VerticalContentAlignment="Center" Padding="6,0"
                                 Text="rtsp://"/>
                    </StackPanel>
                </StackPanel>

                <!-- 播放控制 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Name="BtnStart" Content="开始检测" Style="{StaticResource PrimaryButtonStyle}"
                            Width="80" Height="30" Click="BtnStart_Click" Margin="0,0,4,0"/>
                    <Button Name="BtnStop" Content="停止" Style="{StaticResource DangerButtonStyle}"
                            Width="60" Height="30" Click="BtnStop_Click" Margin="0,0,4,0" IsEnabled="False"/>
                    <Button Name="BtnPause" Content="暂停" Style="{StaticResource SecondaryButtonStyle}"
                            Width="60" Height="30" Click="BtnPause_Click" Margin="0,0,4,0" IsEnabled="False"/>
                    <Button Name="BtnResume" Content="继续" Style="{StaticResource SecondaryButtonStyle}"
                            Width="60" Height="30" Click="BtnResume_Click" Margin="0,0,4,0" IsEnabled="False"/>
                </StackPanel>

                <!-- 模型和置信度 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Text="置信度:" VerticalAlignment="Center" Margin="0,0,6,0" 
                              Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"/>
                    <Slider Name="SldConfidence" Width="100" Minimum="0" Maximum="1" TickFrequency="0.1"
                            TickPlacement="BottomRight" IsSnapToTickEnabled="True" Value="0.5"
                            VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Name="TxtConfidence" Text="0.50" VerticalAlignment="Center" 
                              Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Width="40"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 视频显示区 -->
        <Border Grid.Row="2" Background="#0a0a0a">
            <Grid>
                <!-- 视频画布 -->
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <Grid Name="VideoContainer" HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Image Name="VideoImage" Stretch="Uniform"/>
                        <Canvas Name="DetectionCanvas" Background="Transparent">
                            <!-- 检测框将在这里绘制 -->
                        </Canvas>
                    </Grid>
                </ScrollViewer>

                <!-- 检测结果列表 -->
                <Border HorizontalAlignment="Right" VerticalAlignment="Top" 
                        Margin="12" Background="#80000000" Padding="8" CornerRadius="3" Width="200">
                    <StackPanel>
                        <TextBlock Text="检测结果" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" 
                                  FontSize="12" Margin="0,0,0,6"/>
                        <ListBox Name="LstDetections" Background="Transparent" BorderThickness="0" 
                                 MaxHeight="200" Padding="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="Transparent" CornerRadius="2" Padding="4,3" Margin="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Width="8" Height="8" Background="#22c55e" 
                                                    CornerRadius="1" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding DisplayText}" Margin="6,0,0,0"
                                                      Foreground="{StaticResource TextPrimaryBrush}" FontSize="10"
                                                      TextTrimming="CharacterEllipsis"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- 底部信息栏 -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,1,0,0" Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Name="TxtStatus" Text="请选择视频源并开始检测" 
                          Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
                <TextBlock Grid.Column="1" Name="TxtFrameInfo" Text="" 
                          Foreground="{StaticResource TextSecondaryBrush}" FontSize="11" Margin="20,0,20,0"/>
                <TextBlock Grid.Column="2" Name="TxtFPS" Text="" 
                          Foreground="{StaticResource TextSecondaryBrush}" FontSize="11"/>
            </Grid>
        </Border>
    </Grid>
</Window>